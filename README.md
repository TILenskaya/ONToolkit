# ONToolkit

Tatiana Lenskaia (lensk010@umn.edu) and Declan Schroeder (dcschroe@umn.edu)

A library of computational tools for exploring Oxford Nanopore sequencing data.


## Part I. Data preprocessing

We have developed several Python scripts that are useful for preprocessing of long-read sequencing data generated by Oxford Nanopore Technology (ONT).
The scripts are located in the Code directory and include as follows:

1. __FASTQ4barcode.py__ <br> 
The script creates a single FASTQ file for a given barcode.


2. __qc_check.py__ <br>
The script checks the sequence quality and helps filter low-quality reads if necessary


3. __core_methods.py__ <br>
The script contains several helpful routines for file processing.

## Part II. Genome assembly

We employ Minimap2 to streamline genome assembly to a reference genome. The following additional methods are useful for generating the consensus genome from the aligned reads: samstools (in particular, view, sort, index, and mpileup), bcftools, and seqtk. After the forementioned computational tools are installed and a suitable reference genome is identified (e.g., _MZ423536.1.fasta_), one can use a command line to assemble a consensus genome from reads strored in a FASTQ file (e.g., _FAQ12345_barcode01.fastq_) using the following commands:

__minimap2 -ax map-ont__ _MZ423536.1.fasta_ _FAQ12345_barcode01.fastq_ > _FAQ12345_barcode01_all.sam_

__samtools view -S -b__ _FAQ12345_barcode01_all.sam_ > _FAQ12345_barcode01_all.bam_

__samtools sort__ _FAQ12345_barcode01_all.bam_ __-o__ _FAQ12345_barcode01_all_sorted.bam_

__samtools index__ _FAQ12345_barcode01_all_sorted.bam_

<br><br>

To create a consensus sequence:

__samtools mpileup -uf__ _MZ423536.1.fasta FAQ12345_barcode01_all_sorted.bam_ | __bcftools call -c | vcfutils.pl vcf2fq__ > _FAQ12345_barcode01_all_sorted_cns.fastq_

__seqtk seq -aQ64 -q20 -n N__ _FAQ12345_barcode01_all_sorted_cns.fastq_ > _FAQ12345_barcode01_all_sorted_cns.fasta_

The resulting consensus genome is polished using a Python script __Polish.py__ to eliminate a mixture of lower-case and upper-case letters in the consensus sequence. The script is located in the Code directory.

<br><br>

To get information about coverage:

__samtools mpileup -f__ _MZ423536.1.fasta FAQ12345_barcode01_all_sorted.bam_ > _FAQ12345_barcode01_all_coverage.txt_


<br><br>


We found it useful to combine the information obtained from the consensus sequence with the information provided by samtools mpileup including read coverage, base quality, etc. The resulting file reflects this information in a tabular form by a genome position. The resulting file for each consensus sequence is obtained by running a Python script called __GetCoverage.py__. The script takes a consensus genome in fasta format and txt file generated by samtools mpileup and outputs a text file with the information combined by genome position. 






## Part III. Genome variability

We have created a collection of Python scripts to explore genome variability. These scrips include as follows:

__ExploreVariants.py__ <br>

The script takes a list of files, a list of genes, and a list of primers as an input. For each file in the input file list, the script takes the file generated by __GetCoverage.py__ and annotates changes observed in each position with respect to aminoacid changes in genes and variability in primer regions. For each input file from the file list, the script generates the corresponding file with variant annotation in tabular form.

 __Gencode.py__ <br>
 The script helps explore the significance of a variant, e.g., synonymous vs. non-synonymous. 
  
 __Parse_bases.py__ <br>
 The script provides opportunity to explore read support for a reference base and alternative bases.
